var app=angular.module("RAS");

app.controller("HomePanel",function($scope,$rootScope,homeDataService,testDataService){
	$scope.refreshAll=function(){
		homeDataService.getAllPlacements(function(response){
				$scope.placements=response.data;
				$rootScope.lazilyInitializeDataTable("PlacementTable");
			},
			function(){
				$rootScope.lazilyInitializeDataTable("PlacementTable");
			}
		);
		homeDataService.getAllInterviews(function(response){
				$scope.interviews=response.data;
				$rootScope.lazilyInitializeDataTable("InterviewTable");
			},
			function(){
				$rootScope.lazilyInitializeDataTable("SubmissionTable");
			}
		);
		homeDataService.getAllSubmissions(function(response){
				$scope.submissions=response.data;
				$rootScope.lazilyInitializeDataTable("SubmissionTable");
			},
			function(){
				$rootScope.lazilyInitializeDataTable("SubmissionTable");
			}
		);
	};
	$scope.refreshAll();
	$rootScope.updateNavbarSelection("Home");
	$scope.launchExperiment=function(){
		var Box=$("#ExperimentBox")[0];
		testDataService.compareQuestion(Box.value,function(response){
			Box.value=response.data.Question;
		});
	};
});

app.service("homeDataService",function($http){
	this.getAllPlacements=function(callback,fallback){
		$http.get('placements').then(callback,fallback);
	};
	this.getAllInterviews=function(callback,fallback){
		$http.get('interviews').then(callback,fallback);
	};
	this.getAllSubmissions=function(callback,fallback){
		$http.get('submissions').then(callback,fallback);
	};
});

app.service("testDataService",function($http){
	this.compareQuestion=function(question,callback,fallback){
		$http({
			method:"POST",
			url:"/compareQuestion",
			headers:{
				"Content-Type":"application/json"
			},
			data:{Question:question}
		})
		.then(callback,fallback);
	};
});